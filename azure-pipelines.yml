variables:
    customInstallation: 'brew update && brew install graphviz doxygen boost eigen gmp mpfr tbb cgal'
  
jobs:
  
  - job: 'Test'
    displayName: "Build and test"
    timeoutInMinutes: 0
    cancelTimeoutInMinutes: 300
  
    strategy:
      matrix:
        macOSrelease:
          imageName: 'macos-10.14'
          CMakeBuildType: Release
        macOSdebug:
          imageName: 'macos-10.14'
          CMakeBuildType: Debug
  
    pool:
      vmImage: $(imageName)
  
    steps:
    - task: UsePythonVersion@0
      inputs:
        versionSpec: '3.7'
        architecture: 'x64'
  
    - script: |
        $(customInstallation)
        git submodule update --init
        python -m pip install --upgrade pip
        python -m pip install --user pytest Cython matplotlib numpy scipy scikit-learn # sphinx sphinxcontrib-bibtex sphinx-paramlinks

        python -m pip install --user POT pybind11
      displayName: 'Install build dependencies'
    - script: |
        ls
        mkdir build
        cd build
        cmake -DCMAKE_BUILD_TYPE:STRING=$(CMakeBuildType) -DWITH_GUDHI_TEST=ON -DWITH_GUDHI_UTILITIES=ON -DWITH_GUDHI_PYTHON=ON -DUSER_VERSION_DIR=version -DPython_ADDITIONAL_VERSIONS=3 ..
        make -j all
        ctest --output-on-failure -E sphinx # As sphinx build fail
        make doxygen
      displayName: 'Build, test and documentation generation'
