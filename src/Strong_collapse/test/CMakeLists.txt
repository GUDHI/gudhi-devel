project(Strong_collapse_tests)

include(GUDHI_test_coverage)

add_executable ( Strong_collapse_flag_complex_sparse_matrix_test_unit test_flag_complex_sparse_matrix.cpp )
add_executable ( Strong_collapse_tower_assembler_test_unit test_tower_assembler.cpp )
target_link_libraries(Strong_collapse_flag_complex_sparse_matrix_test_unit ${Boost_UNIT_TEST_FRAMEWORK_LIBRARY})
target_link_libraries(Strong_collapse_tower_assembler_test_unit ${Boost_UNIT_TEST_FRAMEWORK_LIBRARY})
if (TBB_FOUND)
  target_link_libraries(Strong_collapse_flag_complex_sparse_matrix_test_unit ${TBB_LIBRARIES})
  target_link_libraries(Strong_collapse_tower_assembler_test_unit ${TBB_LIBRARIES})
endif()

gudhi_add_coverage_test(Strong_collapse_flag_complex_sparse_matrix_test_unit)
gudhi_add_coverage_test(Strong_collapse_tower_assembler_test_unit)

if (DIFF_PATH)
  # Generated by Strong_collapse_tower_assembler_test_unit
  add_test(Strong_collapse_tower_assembler_diff_1_3_test_unit ${DIFF_PATH}
          "tower_assembler_1.txt" "tower_assembler_3.txt")
  add_test(Strong_collapse_tower_assembler_diff_3_5_test_unit ${DIFF_PATH}
          "tower_assembler_3.txt" "tower_assembler_5.txt")

  # Run Strong_collapse_tower_assembler_test_unit.
  # If Strong_collapse_tower_assembler_test_unit passed, then run the 2 diffs tests.
  # If Strong_collapse_tower_assembler_test_unit failed, then the 2 diffs tests are skipped.

  set_tests_properties(Strong_collapse_tower_assembler_diff_1_3_test_unit
                       Strong_collapse_tower_assembler_diff_3_5_test_unit
                       PROPERTIES FIXTURES_REQUIRED Strong_collapse_tower_assembler_fixture)
  set_tests_properties(Strong_collapse_tower_assembler_test_unit
                       PROPERTIES FIXTURES_SETUP    Strong_collapse_tower_assembler_fixture)
endif()
