language: cpp 

sudo: required 

git: 
 depth: 3

os: osx
osx_image: xcode10.2
compiler: clang

env:
  - CMAKE_OPTIONS='-DWITH_GUDHI_EXAMPLE=ON -DWITH_GUDHI_TEST=ON -DWITH_GUDHI_UTILITIES=ON -DWITH_GUDHI_PYTHON=ON -DPython_ADDITIONAL_VERSIONS=3'

cache:
  directories:
    - $HOME/.cache/pip
    - $HOME/Library/Caches/Homebrew

before_install:
  - brew unlink python@2 && brew upgrade python

addons:
  homebrew:
    packages:
      - python3
      - cmake
      - graphviz 
      - doxygen
      - boost
      - eigen
      - gmp
      - mpfr
      - tbb
      - cgal
      update: true

before_cache:
  - rm -f $HOME/.cache/pip/log/debug.log
  - brew cleanup

# When installing through libcgal-dev apt, CMake Error at CGAL Exports.cmake The imported target "CGAL::CGAL Qt5" references the file
install: 
  - brew list
  - python3 -m pip install --upgrade pip
  - python3 -m pip install -U -r .github/build-requirements.txt
  - python3 -m pip install -U -r .github/test-requirements.txt

script: 
  - rm -rf build
  - mkdir -p build 
  - cd build 
  - cmake -DCMAKE_BUILD_TYPE=Release ${CMAKE_OPTIONS} .. 
  - make -j 4 all
  #- make doxygen
  - ctest -j 4 --output-on-failure

notifications:
  email:
    on_success: change # default: always
    on_failure: always # default: always
